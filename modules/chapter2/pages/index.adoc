= Migration Artifact

The Migration Artifact Structure and Verification is a crucial aspect of the Red Hat Ansible Automation Platform 2.5 migration process, serving as the central component for transferring your deployment from one installation type to another. This guide specifically focuses on enabling migration between different deployment types, such as RPM-based to container-based installations.

In the larger context of Ansible Automation Platform 2.5 Migration, the creation and verification of the migration artifact are integrated into the overall workflow. The general migration process involves:

. Preparing and assessing the source environment.
. Exporting the source environment, which includes creating the migration artifact.
. Creating and verifying the migration artifact.
. Preparing and assessing the target environment.
. Importing the migration content to the target environment.
. Reconciling the target environment post-import.
. Validating the target environment.

*Migration Artifact: Purpose and Structure*

The migration artifact is a `comprehensive package` that contains all the necessary data and configurations from your source Ansible Automation Platform deployment. This exported data is then used to configure your new target environment.

The recommended structure for the migration artifact is as follows:

. / (Root directory of the artifact)
.. manifest.yml
.. secrets.yml
.. sha256sum.txt (for checksum verification)
.. controller/ (directory for automation controller data)
... controller.pgc (PostgreSQL database dump)
.. custom_configs/ (directory for custom configuration files)
... foo.py
... bar.py
.. gateway/ (directory for platform gateway data)
... gateway.pgc (PostgreSQL database dump)
.. hub/ (directory for automation hub data)
... hub.pgc (PostgreSQL database dump)

*Manifest File (manifest.yml)*

The `manifest.yml` file acts as the primary metadata document for the migration artifact. It provides critical versioning and component information about your source environment. Its structure includes:

- aap_version: The specific Ansible Automation Platform version being migrated (e.g., X.Y).
- Platform: The type of the source platform (e.g., rpm).
- Components: A list detailing each component's name and version (e.g., controller, hub, gateway, with their respective versions x.y.z).

*Secrets File (secrets.yml)*

The `secrets.yml` file within the migration artifact is vital as it contains essential Django `SECRET_KEY values and other sensitive data` required for authentication between services. It includes database names and secret keys for various components. The source explicitly states the importance of ensuring this file is `encrypted and kept in a secure location.

Its structure contains redacted values for:

- controller_pg_database
- controller_secret_key
- gateway_pg_database
- gateway_secret_key
- hub_pg_database
- hub_secret_key
- hub_db_fields_encryption_key

*Migration Artifact Creation and Verification Checklist*

To ensure the integrity and completeness of the migration artifact, the sources provide a checklist for verification:

- Database dumps: You must include complete database dumps for each component. This involves ensuring the presence of controller.pgc, hub.pgc, and gateway.pgc in the artifact. The process of performing these dumps is detailed for both RPM-based and container-based source environments.

- Secret dumps: All security-related information must be exported and included, verifying that all secret values are present in the secrets.yml file. Specific commands are provided to extract these secrets from both RPM and containerized environments.

- Custom configurations: Any customizations from the source environment, such as custom Python scripts or modules (e.g., foo.py, bar.py), should be packaged and validated as present in the artifact. Non-standard configurations should also be documented.

- Database information: Documentation of database details is required, including database names, users, required permissions, and any specific configurations or optimizations. The process for gathering this information from the source environment is also outlined.

- Verification: This step ensures the artifact's integrity and completeness:
.. Verify that all required files are included.
.. Verify that checksums exist for all included database files.
.. Test the artifact's structure and accessibility.
.. Consider encrypting the artifact for secure transfer to the target environment.
.. Document any known limitations or special considerations.

The packaging of the artifact typically involves creating a `sha256sum.txt` file for database dumps, then archiving the artifact content into a `.tar` file and generating a checksum for the archive. This artifact is then transferred to the target environment.